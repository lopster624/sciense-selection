{% extends 'base.html' %}
{% load static %}
{% block title %}
Создание заявки
{% endblock %}
{% block content %}
{% include 'includes/header_template.html' %}
{% include 'application/includes/nav_app_template.html' %}
{% load application_extras %}

<div class="container mt-2">
    {% if msg %}
        <div class="btn w-50" style="margin-left: 25%"> {{msg}}
            <button type="button" class="btn btn-outline-primary">
                <a href="{% url name app_id %}">Выбрать</a>
            </button>
        </div>
    {% else %}
    <div class="col-6 offset-3">
    <form action="{% url 'choose_app_competence' app_id %}" method="POST">
        {% csrf_token %}
        {% for comp_lvl1 in competencies %}
        <li class="list-group-item list-group-item-light mb-2">
            <div class="form-group col-12">
            <div class="row mb-1">
                <div class="ms-1 fs-4 col-8">{{comp_lvl1.name}}</div>
                {% if comp_lvl1.is_estimated %}
                    <div class="col-2">
                        <select class="form-select" id="{{ comp_lvl1.id }}" name="{{ comp_lvl1.id }}" {% if user.member.role.id == 3 %}disabled{%endif%}>
                            {% for level in levels %}
                                <option value="{{ level.0 }}" {% if comp_lvl1.id in selected_competencies.keys and selected_competencies|getkey:comp_lvl1.id == level.0 %} selected {% endif %}>
                                    {{ level.0 }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}
            </div>
            </div>
            {% for comp_lvl2 in comp_lvl1.child.all %}
            <div class="ms-5">
                <div class="form-group col-12">
                <div class="row mb-1">
                    <div class="ms-1 fs-5 col-8">{{comp_lvl2.name}}</div>
                    {% if comp_lvl2.is_estimated %}
                        <div class="col-2">
                            <select class="form-select" id="{{ comp_lvl2.id }}" name="{{ comp_lvl2.id }}" {% if user.member.role.id == 3 %}disabled{%endif%}>
                                {% for level in levels %}
                                    <option value="{{ level.0 }}" {% if comp_lvl2.id in selected_competencies.keys and selected_competencies|getkey:comp_lvl2.id == level.0 %} selected {% endif %}>
                                        {{ level.0 }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    {% endif %}
                </div>
                </div>

                {% for comp_lvl3 in comp_lvl2.child.all %}
                <div class="ms-5">
                    <div class="form-group col-12">
                    <div class="row mb-1">
                        <div class="ms-1 fs-6 col-8">{{comp_lvl3.name}}</div>
                        {% if comp_lvl3.is_estimated %}
                            <div class="col-2">
                                <select class="form-select" id="{{ comp_lvl3.id }}" name="{{ comp_lvl3.id }}" {% if user.member.role.id == 3 %}disabled{%endif%}>
                                    {% for level in levels %}
                                        <option value="{{ level.0 }}" {% if comp_lvl3.id in selected_competencies.keys and selected_competencies|getkey:comp_lvl3.id == level.0 %} selected {% endif %}>
                                            {{ level.0 }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        {% endif %}
                    </div>
                    </div>

                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </li>
        {% endfor %}
        {% if user.member.role.id == 1 %}
            <button type="submit" class="w-10 btn btn-primary justify-content-center" style="margin-left: 45%;">Сохранить</button>
        {% endif %}
    </form>
    </div>
    {% endif %}
</div>

{% endblock %}